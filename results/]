import csv
import os
from matplotlib import pyplot as plt

for filename in os.listdir("."):
    if not filename.startswith("mbart"):
        continue
    fold = "test" if "test" in filename else "gen"
    x = []
    exact = []
    first = []
    with open(filename, "r") as in_file:
        csv_reader = csv.reader(in_file)
        next(csv_reader)   # skip header
        for row in csv_reader:
            iteration, exact_match, first_token = row
            x.append(iteration)
            exact.append(exact_match)
            first.append(first_token)
        new_x, new_exact = zip(*sorted(zip(x, exact)))
        _, new_first = zip(*sorted(zip(x, first)))
        
        plt.plot(new_x, new_exact, label="Exact match")
        plt.plot(new_x, new_first, label="First token")
        plt.legend()
        plt.title("mBART generalization accuracies (bs=32)")
        plt.savefig("analysis/mBART-gen.png", format="png", bbox_inches="tight") 
        plt.cla(); plt.clf()
